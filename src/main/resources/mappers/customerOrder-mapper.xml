<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CustomerOrder">
	<resultMap type="com.kh.pmfp.customer.model.vo.MaterialImage"
		id="materialResultSet">
		<id property="materialNo" column="MATERIAL_NO" />
		<result property="materialCateg" column="MATERIAL_CATEG" />
		<result property="materialName" column="MATERIAL_NAME" />
		<result property="materialSize" column="MATERIAL_SIZE" />
		<result property="materialWeight" column="MATERIAL_WEIGHT" />
		<!-- <result property="materialBuyprice" column="MATERIAL_BUYPRICE" /> -->
		<result property="materialSellprice" column="MATERIAL_SELLPRICE" />
		<result property="materialStatus" column="MATERIAL_STATUS" />
		<result property="imgNo" column="IMG_NO" />
		<result property="imgCateg" column="IMG_CATEG" />
		<result property="imgOriginname" column="IMG_ORIGINNAME" />
		<result property="imgChangename" column="IMG_CHANGENAME" />
		<result property="imgFilepath" column="IMG_FILEPATH" />
		<result property="imgUploaddate" column="IMG_UPLOADDATE" />
		<result property="imgStatus" column="IMG_STATUS" />
		<result property="boardNo" column="BOARD_NO" />
		<result property="mypizzaNo" column="MYPIZZA_NO" />
		<result property="eventNo" column="EVENT_NO" />
		<result property="basicNo" column="BASIC_NO" />
	</resultMap>
	
	<resultMap type="com.kh.pmfp.customer.model.vo.BasicMenu"
		id="basicMenuResultSet">
		<id property="basicNo" column="BASIC_NO" />
		<result property="basicSize" column="BASIC_SIZE" />
		<result property="basicMenu" column="BASIC_MENU" />
	</resultMap>

	<resultMap type="com.kh.pmfp.customer.model.vo.BasicTopping"
		id="basicToppingResultSet">
		<result property="basicNo" column="BASIC_NO" />
		<result property="materialNo" column="MATERIAL_NO" />
		<result property="basicTcount" column="BASIC_TCOUNT" />
	</resultMap>
	
	<resultMap type="com.kh.pmfp.customer.model.vo.MyPizza"
		id="myPizzaListResultSet">
		<result property="mypizzaNo" column="MYPIZZA_NO" />
		<result property="mypizzaName" column="MYPIZZA_NAME" />
		<result property="materialNo" column="MATERIAL_NO" />
		<result property="materialCateg" column="MATERIAL_CATEG" />
		<result property="orderTcount" column="ORDER_TCOUNT" />
	</resultMap>
	
	<!-- 재료 전체 리스트 가져오기 -->
	<select id="selectMateList" resultMap="materialResultSet">
		SELECT *
		FROM MATERIAL M
		LEFT OUTER JOIN IMAGE I
		ON (M.MATERIAL_NO = I.MATERIAL_NO
			AND I.IMG_STATUS = 'Y')
		WHERE M.MATERIAL_STATUS = 'Y'
		AND M.MATERIAL_CATEG <![CDATA[ < ]]> 6
	</select>
	
	<!-- 기본 메뉴 리스트 가져오기 -->
	<select id="selectBasicMenuList" resultMap="basicMenuResultSet">
		SELECT *
		FROM BASIC_MENU
	</select>
	<select id="selectBasicToppingList" resultMap="basicToppingResultSet">
		SELECT *
		FROM BASIC_TOPPING
	</select>
	
	<!-- 레시피 저장 -->
	<select id="selectOrderIno" resultType="_int">
		SELECT SEQ_ODITNO.NEXTVAL FROM DUAL
	</select>
	<select id="selectMypizzaNo" resultType="_int">
		SELECT SEQ_MYPZNO.NEXTVAL FROM DUAL
	</select>
	<insert id="insertRecipeOrderItem" parameterType="com.kh.pmfp.customer.model.vo.OrderItem">
		INSERT INTO ORDER_ITEM(ORDER_INO,ORDER_NO,ORDER_ICATEG,ORDER_ISIZE)
	    VALUES(#{orderIno},0,0,#{orderIsize})
	</insert>
	<insert id="insertRecipeOrderTopping" parameterType="com.kh.pmfp.customer.model.vo.OrderTopping">
		INSERT INTO ORDER_TOPPING(ORDER_INO,MATERIAL_NO,ORDER_TCOUNT)
    	VALUES(#{orderIno},#{materialNo},#{orderTcount})
	</insert>
	<insert id="insertRecipeMyPizza" parameterType="com.kh.pmfp.customer.model.vo.MyPizza">
		INSERT INTO MY_PIZZA(MYPIZZA_NO,ORDER_INO,MEMBER_NO,MYPIZZA_NAME)
    	VALUES(#{mypizzaNo},#{orderIno},#{memberNo},#{mypizzaName})
	</insert>
	<insert id="insertRecipeImage" parameterType="com.kh.pmfp.customer.model.vo.Image">
		INSERT INTO IMAGE(IMG_NO,IMG_CATEG,IMG_ORIGINNAME,IMG_CHANGENAME,IMG_FILEPATH,IMG_UPLOADDATE,IMG_STATUS,BOARD_NO,MATERIAL_NO,MYPIZZA_NO,EVENT_NO,BASIC_NO)
    	VALUES(SEQ_IMGNO.NEXTVAL,4,#{imgOriginname},#{imgChangename},#{imgFilepath},SYSDATE,'Y',null,null,#{mypizzaNo},null,null)
	</insert>
	
	<!-- 내 레시피 목록 가져오기 -->
	<select id="selectMyPizzaList" resultMap="myPizzaListResultSet" parameterType="_int">
		SELECT MP.MYPIZZA_NO, MP.MYPIZZA_NAME,
		    OT.MATERIAL_NO, OT.ORDER_TCOUNT,
		    MA.MATERIAL_CATEG
		FROM MY_PIZZA MP
		JOIN ORDER_TOPPING OT ON (MP.ORDER_INO = OT.ORDER_INO
		    AND MP.MEMBER_NO = #{memberNo})
		JOIN MATERIAL MA ON (OT.MATERIAL_NO = MA.MATERIAL_NO)
	</select>
	
	<!-- 사이즈 메뉴 리스트 가져오기 -->
	<select id="selectSideList" resultMap="materialResultSet">
		SELECT *
		FROM MATERIAL M
		LEFT OUTER JOIN IMAGE I
		ON (M.MATERIAL_NO = I.MATERIAL_NO
			AND I.IMG_STATUS = 'Y')
		WHERE M.MATERIAL_STATUS = 'Y'
		AND M.MATERIAL_CATEG = 5
	</select>
	
</mapper>




















